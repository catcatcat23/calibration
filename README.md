
## 1. èƒŒæ™¯ä¸åŠ¨æœº

æ·±åº¦æ¨¡å‹å¸¸**è¿‡åº¦è‡ªä¿¡**ï¼Œå³ç½®ä¿¡åº¦ä¸ç­‰äºçœŸå®æ¦‚ç‡ã€‚\*\*æ ¡å‡†ï¼ˆCalibrationï¼‰\*\*æ—¨åœ¨å°½é‡ä¸å½±å“å‡†ç¡®ç‡çš„å‰æä¸‹ï¼Œè®©é¢„æµ‹æ¦‚ç‡æ›´æ¥è¿‘çœŸå®æ¦‚ç‡ã€‚

ç†æƒ³æ ¡å‡†æ–¹æ³•åº”åŒæ—¶å…·å¤‡ï¼š**ä¿æŒå‡†ç¡®ç‡**ã€**æ•°æ®é«˜æ•ˆ**ã€**è¡¨è¾¾åŠ›å¼º**ã€‚å•ä¸€ä¼ ç»Ÿæ–¹æ³•éš¾å…¼é¡¾ä¸‰è€…ï¼›**Mix-n-Match** é€šè¿‡\*\*é›†æˆï¼ˆEnsembleï¼‰**ä¸**ç»„åˆï¼ˆCompositionï¼‰\*\*ç»¼åˆæå‡ã€‚

---

## 2. ä¼ ç»Ÿæ ¡å‡†æ–¹æ³•

### 2.1 å‚æ•°åŒ–ï¼ˆæ•°æ®é«˜æ•ˆã€è¡¨è¾¾æœ‰é™ï¼‰

* **æ¸©åº¦ç¼©æ”¾ï¼ˆTSï¼‰**

$$
\sigma_{\mathrm{SM}}(z;T)_k=\frac{\exp(z_k/T)}{\sum_{j}\exp(z_j/T)},\quad T>0.
$$

$T<1$ åˆ†å¸ƒå˜å°–ï¼Œ$T>1$ åˆ†å¸ƒå˜å¹³ã€‚

* **å‘é‡ç¼©æ”¾ï¼ˆVSï¼‰**

$$
\sigma_{\mathrm{VS}}(z)_k=\frac{\exp(a_k z_k + b_k)}{\sum_{j}\exp(a_j z_j + b_j)}.
$$

* **çŸ©é˜µç¼©æ”¾ï¼ˆMSï¼‰**

$$
\sigma_{\mathrm{MS}}(z)=\mathrm{softmax}(Wz+b).
$$


### 2.2 éå‚æ•°åŒ–ï¼ˆè¡¨è¾¾å¼ºã€æ•°æ®æ•ˆç‡ä½ï¼‰

ç›´æ–¹å›¾åˆ†ç®±ï¼ˆHistogram Binningï¼‰ã€ä¿åºå›å½’ï¼ˆIRï¼‰ã€Beta æ ¡å‡†ã€BBQ ç­‰ã€‚

---

## 3. Mix-n-Matchï¼šæ ¸å¿ƒæ€æƒ³

### 3.1 ä¿æŒå‡†ç¡®ç‡çš„æ ¡å‡†æ˜ å°„

å¯¹åŒä¸€æ ·æœ¬å„åˆ†é‡æ–½åŠ **åŒä¸€ä¸¥æ ¼å•è°ƒå¢**å‡½æ•° $g$ åå†å½’ä¸€åŒ–ï¼š

$$
T(z)=\frac{\big(g(z_1),\,\dots,\,g(z_L)\big)}{\sum_{\ell=1}^{L} g(z_\ell)}.
$$

ç±»åˆ«æ’åºä¸å˜ï¼Œ**ä¸æ”¹åŠ¨ top-1**ï¼Œä»è€ŒåŸºæœ¬ä¸å½±å“å‡†ç¡®ç‡ã€‚

### 3.2 é›†æˆï¼ˆEnsembleï¼‰

**(a) æ¨¡å‹é›†æˆ**ï¼ˆæŠŠå¤šä¸ªä¿å‡†ç¡®ç‡çš„æ˜ å°„åŠ æƒï¼‰

$$
\mathbf q(z)=\sum_{j=1}^{M} w_j\,T\!\left(z;\theta_j\right),\qquad \sum_{j} w_j=1.
$$

**ä¾‹ï¼šé›†æˆæ¸©åº¦ç¼©æ”¾ï¼ˆETSï¼‰**ï¼ˆåœ¨æ¦‚ç‡ç©ºé—´æ··åˆï¼‰

$$
\mathbf q_{\mathrm{ETS}}(z;w,t)=
w_1\,\sigma_{\mathrm{SM}}(z/t)+
w_2\,\sigma_{\mathrm{SM}}(z/1)+
w_3\,\tfrac{1}{L}\mathbf 1,
\quad
w_1+w_2+w_3=1.
$$

**(b) æ•°æ®é›†æˆï¼ˆIRMï¼‰**
æŠŠæ‰€æœ‰ç±»åˆ«æ ·æœ¬æ±‡æ€»å­¦ä¹ **ä¸€ä¸ª**éå‚æ•°å‡½æ•°ï¼Œæ•°æ®æ•ˆç‡é«˜ï¼›ç›¸æ¯” IROvA è¡¨è¾¾ç•¥å¼±ã€‚

### 3.3 ç»„åˆï¼ˆCompositionï¼‰

å…ˆå‚æ•°åŒ–â€œç²—æ ¡å‡†â€ï¼Œå†éå‚æ•°åŒ–â€œç²¾ä¿®â€ï¼ˆå¦‚ **IROvAâ†’TS** æˆ– **TSâ†’IROvA**ï¼‰ã€‚ç»„åˆé€šå¸¸æ›´å¼ºï¼›æ˜¯å¦ä¿æŒå‡†ç¡®ç‡å–å†³äºå…·ä½“å®ç°ã€‚

---

## 4. æŒ‡æ ‡ï¼šä» ECE åˆ° KDE-based ECE

### 4.1 ç»å…¸ ECE

ä»¤ $Z$ ä¸ºç½®ä¿¡åº¦ï¼Œ$\pi(Z)$ ä¸ºæ¡ä»¶æ­£ç¡®ç‡å‡½æ•°ï¼š

$$
\mathrm{ECE}_d(f)=\mathbb{E}\big[\|Z-\pi(Z)\|_d^{\,d}\big].
$$

å¸¸ç”¨**åˆ†ç®±**ä¼°è®¡ï¼Œæ˜“å—åˆ†ç®±æ•°é‡ä¸è¾¹ç•Œå½±å“ã€‚

### 4.2 KDE-based ECEï¼ˆæ ¸å›å½’æ›¿ä»£åˆ†ç®±ï¼‰

åœ¨ $[0,1]$ ä¸Šç”¨æ ¸å›å½’ä¼°è®¡ $\tilde\pi(z)$ ä¸ $\tilde p(z)$ï¼š

$$
\widetilde{\mathrm{ECE}}_d(f)=\int \big\|z-\tilde\pi(z)\big\|_d^{\,d}\,\tilde p(z)\,dz.
$$

**æ ·æœ¬åŒ–ï¼ˆLOO æ¨èï¼‰**
ç»™å®š $(c_i,\mathrm{acc}_i)$ï¼ŒNadarayaâ€“Watson å›å½’

$$
\hat\pi(c)=\frac{\sum_{i=1}^{n} K\!\big((c-c_i)/h\big)\,\mathrm{acc}_i}{\sum_{i=1}^{n} K\!\big((c-c_i)/h\big)},
$$

å¹¶ç”¨ LOO æ–¹å¼è®¡ç®—

$$
\mathrm{KDE\text{-}ECE}=\frac{1}{n}\sum_{i=1}^{n}\big|\hat\pi^{\setminus i}(c_i)-c_i\big|.
$$

### 4.3 Class-wise ä¸ Multi-class

* **Class-wise**ï¼š


åœ¨ $\mathcal{I}_k=\{\,i:\hat y_i=k\,\}$ ä¸Šï¼Œ$c_i=\hat p_i^{(k)}$ã€$\mathrm{acc}_i=\mathbf{1}_{\{y_i=k\}}$ï¼Œåˆ†åˆ«å¾—åˆ° $\mathrm{KDE\text{-}ECE}_k$ï¼Œå†åŠ æƒï¼š

$$
\mathrm{KDE\text{-}ECE}_{\mathrm{cls}}
=\sum_{k=1}^{K}\frac{|\mathcal{I}_k|}{n}\,\mathrm{KDE\text{-}ECE}_k .
$$


### 4.4 å¸¦å®½ä¸è¾¹ç•Œ

* å¸¦å®½ $h$ï¼šåœ¨ Calib-Learn ä¸Šç”¨ 5-fold CV æœ€å°åŒ– LOO-NLL é€‰æ‹©ï¼›æˆ– Silverman ç»éªŒå¼

  $$
  h_{\mathrm{silver}}=1.06\,\hat\sigma\,n^{-1/5}.
  $$
* è¾¹ç•Œï¼šå¯¹ $[0,1]$ å»ºè®®é•œåƒæ‰©å±•æˆ– Beta æ ¸ä»¥å‡è½»å¤–æº¢ã€‚

### 4.5 å¯é æ€§æ›²çº¿ï¼ˆKDE ç‰ˆï¼‰

åœ¨ç½‘æ ¼ $\{c_g\}_{g=1}^{G}\subset[0,1]$ ä¸Šä½œç‚¹ $(c_g,\hat\pi(c_g))$ ä¸å¯¹è§’çº¿ $y=x$ï¼›Class-wise ä¸ºæ¯ä¸ªç±»ä¸€æ¡ï¼›Multi-class ä¸ºæ¯ç±»ä½œå›¾å¹¶å¯å åŠ å¹³å‡ã€‚

---

## 5. å®éªŒè®¾è®¡ï¼ˆä¸ä½ ç°æœ‰åŸºçº¿å¯¹é½ï¼‰

### 5.1 æ•°æ®ä¸åˆ’åˆ†

* **Train**ï¼šè®­ç»ƒä¸»å¹²
* **Fine-tune**ï¼šFocal å¾®è°ƒï¼ˆå¯ä¸ Train é‡åˆï¼Œæ³¨æ„å›ºå®šè¶…å‚ï¼‰
* **Calib-Learnï¼ˆ30kï¼‰**ï¼šä»…æ‹Ÿåˆ TS / IOP-OI / IROvA
* **Test**ï¼šåªåšæœ€ç»ˆè¯„ä¼°

### 5.2 æ–¹æ³•åˆ†ç»„

* **B0ï¼šCEâ†’TS**
* **B1ï¼šFocal($\gamma$)â†’TS**
* **P-Aï¼šFocalâ†’TSâ†’IOP-OI**ï¼ˆä¿æŒæ¬¡åºä¸ç½®æ¢ä¸å˜ï¼ŒåŠ›æ±‚ä¸æ”¹å‡†ç¡®ç‡ï¼‰
* **P-Bï¼šFocalâ†’TSâ†’IROvA**ï¼ˆä¸€å¯¹å¤š IR + å½’ä¸€åŒ–ï¼‰

> å¯é€‰æ¶ˆèï¼šé¡ºåºäº’æ¢ï¼ˆTSâ†”IOP-OI / TSâ†”IROvAï¼‰ã€Focal çš„ $\gamma\in\{2,3,5\}$ æˆ– FLSD-53ã€‚

### 5.3 å…³é”®å®ç°æ‘˜è¦

* **Focal å¾®è°ƒ**ï¼ˆå¤šç±»ï¼‰

  
  $L_{\mathrm{FL}}=-\sum_{i}\big(1-\hat p_i^{(y_i)}\big)^{\gamma}\,\log \hat p_i^{(y_i)}.$
  
* **æ¸©åº¦ç¼©æ”¾ï¼ˆTSï¼‰**ï¼š$$\mathbf z\mapsto \mathbf z/T$$ï¼ŒT ç”± Calib-Learn ä¸Šçš„ NLL é€‰å®šã€‚
* **IOP-OI**ï¼ˆé¡ºåºä¿æŒ + ç½®æ¢ä¸å˜ï¼‰ï¼š
  æ¯æ ·æœ¬å¯¹ $\mathbf z$ é™åºæ’åºå¾— $z_{(1)}\ge\dots\ge z_{(K)}$ï¼Œç”¨**åŒä¸€**å•è°ƒå‡½æ•° $f_\theta$ æ˜ å°„ $z'_{(r)}=f_\theta(z_{(r)})$ï¼Œå†è¿˜åŸåŸç±»åˆ«é¡ºåºå¹¶ softmaxï¼›Calib-Learn ä¸Šæœ€å°åŒ– NLL å­¦ $\theta$ï¼ˆåˆ†æ®µçº¿æ€§å•è°ƒã€LBFGSã€å¹³æ»‘æ­£åˆ™ï¼‰ã€‚
* **IROvA**ï¼šæ¯ç±» $k$ æ‹Ÿåˆå•è°ƒå‡½æ•° $g_k$ è¿‘ä¼¼ $\Pr(y=k\mid s^{(k)})$ï¼ˆ$s^{(k)}$ å¯ç”¨ $z^{(k)}$ æˆ– marginï¼‰ï¼Œå†å½’ä¸€åŒ– $\hat q^{(k)}=\hat r^{(k)}/\sum_{j}\hat r^{(j)}$ã€‚

### 5.4 æŒ‡æ ‡ä¸ç»Ÿè®¡

* **ä¸»æŒ‡æ ‡**ï¼šKDE-ECEï¼ˆoverall / class-wise / multiï¼‰
* **è¾…æŒ‡æ ‡**ï¼šåˆ†ç®± ECEï¼ˆ15â€“20 binsï¼‰ã€NLLã€Brierã€Top-1
* **æ˜¾è‘—æ€§**ï¼šæ ·æœ¬çº§ bootstrapï¼ˆ1000 æ¬¡ï¼Œ95% CIï¼‰ï¼Œé…å¯¹å·®å€¼ CI ä¸å« 0 è§†ä¸ºæ˜¾è‘—

---

## 6. å®åŠ¡å»ºè®®ï¼ˆ30k æ ¡å‡†é›†ï¼‰

* **éœ€ä¿æŒå‡†ç¡®ç‡ã€æ•°æ®åå°‘**ï¼šä¼˜å…ˆ ETS æˆ– IRMã€‚
* **æ•°æ®å……è¶³ã€å…è®¸è½»å¾®å‡†ç¡®ç‡æ³¢åŠ¨**ï¼šè€ƒè™‘ IROvA-TS æˆ– IROvAã€‚
* **è¯„ä¼°**ï¼šä¼˜å…ˆç”¨ KDE-ECEï¼Œé…åˆå¯é æ€§æ›²çº¿ä¸ NLL/Brierã€‚

---

## 7. å¯¹æ¯”è¡¨

| æ–¹æ³•       | ç±»å‹    | ä¿æŒå‡†ç¡®ç‡  | æ•°æ®æ•ˆç‡ | è¡¨è¾¾åŠ› | é€‚ç”¨åœºæ™¯    |
| -------- | ----- | ------ | ---- | --- | ------- |
| TS       | å‚æ•°åŒ–   | âœ…      | âœ…    | ä½   | å°æ•°æ®/åŸºçº¿  |
| ETS      | é›†æˆå‚æ•°åŒ– | âœ…(é€šå¸¸)  | âœ…    | é«˜   | é€šç”¨æ¨è    |
| IRM      | é›†æˆéå‚  | âœ…      | ä¸­-é«˜  | ä¸­   | æ•°æ®æœ‰é™    |
| IROvA    | éå‚æ•°åŒ–  | ï¼ˆå®ç°ç›¸å…³ï¼‰ | ä½    | é«˜   | å¤§æ•°æ®     |
| IROvA-TS | ç»„åˆ    | ï¼ˆå®ç°ç›¸å…³ï¼‰ | ä¸­    | é«˜   | å¤§æ•°æ®å¤æ‚ä»»åŠ¡ |
| KDE-ECE  | è¯„ä¼°æ–¹æ³•  | â€”      | âœ…    | â€”   | å°æ ·æœ¬è¯„ä¼°   |

> å¤‡æ³¨ï¼šè‹¥ IROvA å„ç±»å…±äº«åŒä¸€å•è°ƒå‡½æ•°ä¸”ä»…åšæ¦‚ç‡åŸŸä¿åºå†å½’ä¸€åŒ–ï¼Œåˆ™å¯ä¿æŒ top-1ï¼›è‹¥å¯¹æ¯ç±»ç‹¬ç«‹æ‹Ÿåˆ $g_k$ å†å½’ä¸€åŒ–ï¼Œåˆ™å¯èƒ½æ”¹å˜ top-1ã€‚

---

## 8. ä¼ªä»£ç ï¼ˆæ¼”ç¤ºé€»è¾‘ï¼‰

**KDE-ECEï¼ˆLOO, overallï¼‰**

```
inputs: confidences c[1..n] in [0,1], accuracy a[1..n] in {0,1}, bandwidth h
for i in 1..n:
  num, den = 0, 0
  for j in 1..n, j != i:
    w = K((c[i]-c[j]) / h)
    num += w * a[j]
    den += w
  pi_hat[i] = num / (den + eps)
KDE_ECE = mean_i |pi_hat[i] - c[i]|
```

**Class-wise KDE-ECE**

```
for each class k:
  I_k = { i : argmax p_i == k }
  compute KDE_ECE_k on (c_i = p_i[k], a_i = 1[y_i==k]) for i in I_k
KDE_ECE_cls = sum_k (|I_k|/n) * KDE_ECE_k
```

**Multi-class KDE-ECE**

```
for each class k:
  pairs = { (p_i[k], 1[y_i==k]) for i in 1..n }
  compute KDE_ECE_k over pairs
KDE_ECE_multi = (1/K) * sum_k KDE_ECE_k
```

**IOP-OIï¼ˆåˆ†æ®µçº¿æ€§å•è°ƒï¼‰**

```
z_sorted, idx = sort_descending(z, dim=1)
z_prime = piecewise_monotone(z_sorted; theta)  # shared, monotone
z_prime = unsort_by(idx, z_prime)
q = softmax(z_prime)
loss = NLL(q, y) + lambda * smooth_reg(theta)
optimize theta (LBFGS/Adam)
```


---

# ğŸ“˜ åŸºäº KDE çš„å››ç§æ ¡å‡†è¯„ä¼°æ–¹æ³•

æ¨¡å‹çš„**ç½®ä¿¡åº¦ (confidence)** ä¸**å‡†ç¡®æ€§ (accuracy)** æ˜¯å¦ä¸€è‡´ï¼Œæ˜¯è¡¡é‡æ¨¡å‹æ˜¯å¦æ ¡å‡† (calibrated) çš„å…³é”®æŒ‡æ ‡ã€‚
ç†æƒ³æƒ…å†µä¸‹ï¼š


$P(y = \hat y \mid c = z) = z, \quad \forall z \in [0,1]$

ä¹Ÿå°±æ˜¯é¢„æµ‹ç½®ä¿¡åº¦ $z$ åº”ç­‰äºçœŸå®ç²¾åº¦ã€‚
ä¼ ç»Ÿçš„ **ECE (Expected Calibration Error)** ä¾èµ–ç›´æ–¹å›¾åˆ†æ¡¶ï¼Œç»“æœä¼šå— bin è¾¹ç•Œå½±å“ï¼›è€Œ **KDE (Kernel Density Estimation)** èƒ½å¹³æ»‘ä¼°è®¡æ¦‚ç‡åˆ†å¸ƒï¼Œæ›´ç¨³å¥ã€‚

---

## 1ï¸âƒ£ Pred-class-wise ECEï¼ˆé¢„æµ‹ç±»å£å¾„ï¼‰

### å®šä¹‰

å¯¹æ¯ä¸ªç±»åˆ« $k$ï¼Œåªè€ƒè™‘ **è¢«é¢„æµ‹ä¸ºè¯¥ç±»** çš„æ ·æœ¬ï¼š

$$
\mathcal{I}_k^{pred} = \{ i \mid \hat y_i = k \}
$$

* æ¨ªè½´ï¼šè¯¥ç±»çš„é¢„æµ‹æ¦‚ç‡

  
  $c_i = p_i^{(k)}$

* çºµè½´ï¼šæ˜¯å¦é¢„æµ‹æ­£ç¡®

  $a_i = \mathbf{1}[y_i = k]$

### KDE ä¼°è®¡

$$
\pi_k(z) = \frac{\sum_{i \in \mathcal{I}_k^{pred}} a_i K_h(z - c_i)}{\sum_{i \in \mathcal{I}_k^{pred}} K_h(z - c_i)}
$$

### è¯¯å·®

$$
\mathrm{ECE}_k = \mathbb{E}_{i \in \mathcal{I}_k^{pred}} \Big| \pi_k(c_i) - c_i \Big|
$$

è¿”å›æ¯ä¸ªç±»åˆ«çš„ ECE å€¼ã€‚

**ç‰¹ç‚¹**

* æ¯ç±»ä¸€æ¡æ›²çº¿ï¼ˆK æ¡çº¿ç»˜åˆ¶åœ¨åŒä¸€å›¾ä¸Šï¼‰ã€‚
* é€‚åˆè¯Šæ–­ï¼šå“ªäº›ç±»è¿‡ç½®ä¿¡ / æ¬ ç½®ä¿¡ã€‚

---

## 2ï¸âƒ£ True-class-wise ECEï¼ˆçœŸå®ç±»å£å¾„ï¼‰

### å®šä¹‰

å¯¹æ¯ä¸ªç±»åˆ« $k$ï¼Œè€ƒè™‘ **æ‰€æœ‰æ ·æœ¬**ï¼Œåˆ†æè¯¥ç±»æ¦‚ç‡åˆ†å¸ƒæ˜¯å¦åˆç†ï¼š

* æ¨ªè½´ï¼šé¢„æµ‹çš„è¯¥ç±»æ¦‚ç‡

  $c_i = p_i^{(k)}$
  
* çºµè½´ï¼šæ˜¯å¦çœŸå®å±äºè¯¥ç±»

  $a_i = \mathbf{1}[y_i = k]$

### KDE ä¼°è®¡

$$
\pi_k(z) = \frac{\sum_{i=1}^N a_i K_h(z - p_i^{(k)})}{\sum_{i=1}^N K_h(z - p_i^{(k)})}
$$

### è¯¯å·®

$$
\mathrm{ECE}_k = \mathbb{E}_i \Big| \pi_k(p_i^{(k)}) - p_i^{(k)} \Big|
$$

**ç‰¹ç‚¹**

* æ¯ç±»ä¸€æ¡æ›²çº¿ï¼ˆK æ¡çº¿ï¼‰ã€‚
* æ˜¯ **one-vs-rest** è§†è§’ï¼Œåæ˜ çœŸå®ç±»çš„æ¦‚ç‡åˆ»åº¦æ˜¯å¦åˆç†ã€‚
* å¯ç”¨äºå‘ç°æŸäº›ç±»ç³»ç»Ÿæ€§ä½ä¼°æˆ–é«˜ä¼°ã€‚

---

## 3ï¸âƒ£ Multiclass ECEï¼ˆå¤šç±»æ•´ä½“å£å¾„ï¼‰

### å®šä¹‰

å¯¹æ¯ä¸ªæ ·æœ¬ $i$ï¼ŒåŒæ—¶è€ƒè™‘å®ƒçš„æ‰€æœ‰ç±»åˆ«æ¦‚ç‡ï¼š

$$
\text{gap}_i = \sum_{k=1}^K \Big| \pi_k(p_i^{(k)}) - p_i^{(k)} \Big|
$$

### è¯¯å·®

$$
\mathrm{ECE}_{multi} = \frac{1}{N}\sum_{i=1}^N \text{gap}_i
$$

$$
\mathrm{MCE}_{multi} = \max_i \text{gap}_i
$$

**ç‰¹ç‚¹**

* è¾“å‡ºä¸€ä¸ªå…¨å±€æŒ‡æ ‡ï¼ˆæ— æ›²çº¿ï¼‰ã€‚
* å®šé‡è¡¡é‡æ•´ä½“æ ¡å‡†æ°´å¹³ã€‚
* ä¸åŒºåˆ†ç±»åˆ«ï¼Œé€‚åˆæ•´ä½“æ¯”è¾ƒæ¨¡å‹æ•ˆæœã€‚

---

## 4ï¸âƒ£ Overall (Top-1) ECEï¼ˆæ•´ä½“ top-1 å£å¾„ï¼‰

### å®šä¹‰

åªçœ‹æ¯ä¸ªæ ·æœ¬çš„ top-1 æ¦‚ç‡ï¼š

$$
c_i = \max_k p_i^{(k)}, \quad a_i = \mathbf{1}[\hat y_i = y_i]
$$

* æ¨ªè½´ï¼štop-1 ç½®ä¿¡åº¦
* çºµè½´ï¼šæ˜¯å¦é¢„æµ‹æ­£ç¡®

### KDE ä¼°è®¡

$$
\pi(z) = \frac{\sum_{i=1}^N a_i K_h(z - c_i)}{\sum_{i=1}^N K_h(z - c_i)}
$$

### è¯¯å·®

$$
\mathrm{ECE}_{overall} = \frac{1}{N} \sum_{i=1}^N \Big| \pi(c_i) - c_i \Big|
$$

$$
\mathrm{MCE}_{overall} = \max_i \Big| \pi(c_i) - c_i \Big|
$$

**ç‰¹ç‚¹**

* åªç”»ä¸€æ¡æ›²çº¿ï¼ˆæœ€ç»å…¸çš„ reliability diagramï¼‰ã€‚
* ä¸æ ‡å‡† ECE å®šä¹‰æœ€æ¥è¿‘ã€‚
* é€‚åˆå¿«é€Ÿè¯„ä¼°æ•´ä½“æ ¡å‡†ã€‚

---

## ğŸ“Š æ€»ç»“å¯¹æ¯”

| æ–¹æ³•              | æ›²çº¿æ•°é‡  | æ ·æœ¬é€‰æ‹©              | é€‚ç”¨åœºæ™¯         |
| --------------- | ----- | ----------------- | ------------ |
| Pred-class-wise | K æ¡æ›²çº¿ | è¢«é¢„æµ‹ä¸ºè¯¥ç±»çš„æ ·æœ¬         | åˆ†æé¢„æµ‹ç±»æ˜¯å¦è¿‡/æ¬ ç½®ä¿¡ |
| True-class-wise | K æ¡æ›²çº¿ | æ‰€æœ‰æ ·æœ¬ï¼ˆone-vs-restï¼‰ | åˆ†æçœŸå®ç±»çš„æ¦‚ç‡åˆ»åº¦åå·® |
| Multiclass      | æ— ï¼ˆæŒ‡æ ‡ï¼‰ | æ¯ä¸ªæ ·æœ¬æ‰€æœ‰ç±»åˆ«æ¦‚ç‡        | æ•´ä½“å…¨å±€æ ¡å‡†æŒ‡æ ‡     |
| Overall (Top-1) | 1 æ¡æ›²çº¿ | æ¯ä¸ªæ ·æœ¬çš„æœ€å¤§æ¦‚ç‡ï¼ˆtop-1ï¼‰  | å¿«é€Ÿè¯„ä¼°æ•´ä½“æ ¡å‡†     |

---
